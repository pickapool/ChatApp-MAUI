<AuthorizeView>
    <Authorized>
        @if (!isLoading && user != null)
        {
            <div class="d-flex flex-row gap-2 align-items-center">
                <MudAvatar Size="Size.Medium">
                    @* <MudImage Src="@(String.IsNullOrEmpty(UserAccount.Photo) ? DefaultPhoto : UserAccount.Photo)"></MudImage> *@
                </MudAvatar>
                <div class="d-flex flex-column pr-5">
                    <MudText Typo="Typo.caption">@user.DisplayName</MudText>
                    <MudText Typo="Typo.caption">@user.Email</MudText>
                </div>
                <MudIconButton Class="navigation" Icon="@Icons.Material.Filled.Settings" Size="Size.Small" Variant="Variant.Text" OnClick="ToggleOpen"></MudIconButton>
                <MudPopover Style="max-height: unset !important;" Open="@_open" Fixed="false" Class="pa-2 profile" AnchorOrigin="Origin.BottomLeft" TransformOrigin="Origin.CenterLeft">
                    <div class="d-flex flex-column" style="width : 200px;">
                        <MudText Typo="Typo.caption">Settings</MudText>
                        <hr style="margin: 4px;" />
                        <MudButton Class="d-flex justify-space-between" EndIcon="@Icons.Material.Filled.Person" Size="Size.Small" Variant="Variant.Text" OnClick="GoToProfile">
                            <MudText Typo="Typo.caption">Profile</MudText>
                        </MudButton>
                        <MudButton Class="d-flex justify-space-between" EndIcon="@Icons.Material.Filled.Logout" Size="Size.Small" Variant="Variant.Text" OnClick="Logout">
                            <MudText Typo="Typo.caption">Logout</MudText>
                        </MudButton>
                    </div>
                </MudPopover>
            </div>
        } else
        {
            <div class="d-flex flex-row gap-2 align-items-center">
                <MudSkeleton SkeletonType="SkeletonType.Circle" Width="40px" Height="40px" style="background-color: white !important;" />
                <div class="d-flex flex-column pr-5">
                    <MudSkeleton Width="80px" style="background-color: white !important;" />
                    <MudSkeleton Width="70px" style="background-color: white !important;" />
                </div>
            </div>
        }
    </Authorized>
</AuthorizeView>
@code {
    AuthTokenModel user;
    private bool _open;
    private string DefaultPhoto = "/images/blank-profile.webp";
    private void ToggleOpen() => _open = !_open;
    private bool isLoading = true;
    protected override async Task OnInitializedAsync()
    {
        isLoading = true;
        string token = await _localStorage.GetItemAsStringAsync("token");
        user = await _loginService.GetUserRecord(token);
        isLoading = false;
    }
    private async Task Logout()
    {
        await _localStorage.RemoveItemAsync("token");
        ((CustomAuthenticationState)_authenticationStateProvider).NotifyUserLogout();
        _navigationManager.NavigateTo("/");
    }
    private void GoToProfile()
    {
        _navigationManager.NavigateTo("/profile");
        _open = false;
    }
}
<style>
    .profile.mud-popover.mud-popover-open {
        left: unset !important;
        top: 7% !important;
        right: 1% !important
    }

    .mud-popover {
        max-height: unset !important;
    }
</style>